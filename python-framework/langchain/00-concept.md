# LangChain

- LLM 기반 애플리케이션 개발을 위한 프레임워크임
- Chain과 Agent라는 두 가지 핵심 기능을 통해 LLM 애플리케이션을 효율적으로 개발하도록 지원함
    - Chain : 작업을 순차적으로 실행하는 파이프라인 구조 제공
    - Agent : 자율적 의사결정이 가능한 실행 단위
        - 최근에는 복잡한 흐름 제어를 위해 `LangGraph` 기반으로 확장하여 구현하기도 함

<div style="text-align: center;">
    <img src="https://python.langchain.com/svg/langchain_stack_112024_dark.svg" 
        alt="langchain_stack" 
        width="600" 
        style="border: 0;">
</div>


## 등장 배경

- LLM을 사용하여 요구 사항에 따라 사용자 질의를 해석할 필요성이 생김
- 이전부터 여러 시스템이나 백엔드 툴을 이용해야 하는 요구 사항이 흔하게 있음
    - 애플리케이션이 두 가지 이상의 DB가 필요할 때 매번 DB 접속을 위한 커넥터를 새로 만들면, 비용이 비쌈 (전문 개발자 필요, 유지/보수/관리/배포 오버헤드 발생)
    - DBMS에 엑세스 하기 위한 표준 API 레이어인 **ODBC**(Open Database Connectivity)와 **JDBC**(Java Database Connectivity)가 등장함
    - 이런 표준 API 레이어는 DB 시스템과 운영체제가 독립적으로 동작함
    - 따라서 애플리케이션에서 데이터 액세스 코드를 거의 변경하지 않고도 클라이언트와 서버의 다른 플랫폼으로 인식할 수 있다는 장점이 있음
- LangChain은 LLM 기반 애플리케이션 개발을 위한 개발자 친화적인 오픈 소스 프레임워크임
    - Python과 JavaScript 라이브러리를 제공함
    - LLM 애플리케이션을 구축한 다음 통합할 수 있는 중앙 집중식 개발 환경을 갖추고 있음


## 구성 요소 (Components)

- Model: 텍스트 생성의 중심으로, 일반 텍스트 입력(LLM) 또는 메시지 기반 입력(Chat Model)을 처리함
- Prompt & Memory: 프롬프트 구성과 대화 히스토리 관리를 통해 일관된 맥락 유지 가능
- Document Handling: Document Loader, Text Splitter를 통해 외부 문서를 불러오고, 처리 가능한 단위로 분할함
- Embedding & Vector Store: 문서를 벡터화하고 Vectorstore에 저장하여 유사도 기반 검색을 수행함
- 각 컴포넌트는 독립적이며, 모듈형 구조로 다양한 조합이 가능함 (ex. RAG 시스템 구축)


## 개념

### 1. LLM 추상화 (Abstraction)

- 추상화 목표는 LLM 사용자에게 불필요한 세부 사항을 숨겨 복잡성을 처리하는 것임
    - 이를 통해 사용자는 숨겨진 복잡성을 모두 이해하거나 생각하지 않고도 제공된 추상화 위에서 본인의 로직을 구현할 수 있음
- LangChain의 추상화로 언어 모델을 연결하여 애플리케이션을 간소화된 프로그래밍으로 만들 수 있음
    - 언어 모델의 복잡한 NLP 작업을 실행하는 데 필요한 코드 양이 최소화됨
- 거의 모든 LLM은 접속을 위한 API 키만 있으면, LangChain에서 사용할 수 있음
    - 표준 인터페이스를 제공하도록 설계되어 있기 때문임

### 2. 프롬프트 (Prompts)

- 프롬프트는 사용자가 LLM에 태스크를 수행하라고 전달하는 명령어임
- LLM이 최대한 정확하고 유용한 정보를 제공할 수 있도록 프롬프트를 잘 작성하는 것이 중요함
- 좋은 프롬프트를 작성하기 위해
    - 얻고자 하는 정보나 결과의 유형을 정확하게 정의하여 질문해야 함
    - LLM이 문맥을 이해할 수 있도록 필요한 배경 정보를 제공하면 좋음
        - Hallucination 발생 위험을 낮추고, 관련성 높은 응답을 생성하는 데 도움을 줌
    - 핵심 정보에 초점을 맞추고, 불필요한 정보는 배제해야 함
        - 불필요한 정보로 LLM이 덜 중요한 부분에 집중할 수 있음
    - 열린 질문으로 LLM이 풍부한 답변을 제공하도록 해야 함
    - 대화의 맥락에 적합한 언어와 문제를 선택해야 함
        - LLM이 상황에 맞는 표현을 선택하는데 도움을 줌
- LangChain에는 명령을 잘 전달하기 위한 ***프롬프트 템플릿*** 클래스가 있음
    - 컨텍스트와 질의를 수동으로 작성할 필요없이 프롬프트의 구성을 구조화해 줌
    - 구성 예시

        | 구분 | 내용 | 예시 |
        |---|---|---|
        | 지시 | LLM에 태스크를 수행하라고 요청하는 구체적인 지시 | 아래 제공된 제품 리뷰를 요약해 주세요. |
        | 예시 | 요청한 태스크를 수행하는 방법에 대한 하나 이상의 예시 | 예를 들어, '이 제품은 매우 사용하기 편리하며 배터리 수명이 길다'라는 리뷰는 '사용 편리성과 긴 배터리 수명이 특징'으로 요약할 수 있습니다. |
        | 맥락 | 요청한 태스크를 수행하기 위한 추가적인 맥락 | 리뷰는 스마트워치에 대한 것이며, 사용자 경험에 초점을 맞추고 있습니다. |
        | 질문 | 어떤 답변을 요구하는 구첵적인 질문 | 이 리뷰를 바탕으로 스마트워키의 주요 장점을 두세 문장으로 요약해주세요. |

- 템플릿 안에는 특정 지침이 포함하거나 Few-Shot 프롬프트를 사용할 수 있음

### 3. 체인 (Chains)

- 체인은 LLM을 다른 구성 요소와 결합하여 일련의 태스크를 실행하여 애플리케이션을 생성함
- 체인의 각 태스크는 서로 다른 프롬프트나 LLM을 사용할 수 있음

### 4. 인덱스 (Indexs)

- 최적의 답변을 위해서는 LLM 뿐만 아니라, 출처가 확실한 고급 전문 정보와 최신 정보가 추가로 필요함 (비용 효율화를 위해 RAG와 같은 기법을 사용함)
    - LLM 학습 데이터셋에 포함되지 않은 외부 데이터 소스를 인덱스 라고함

### 5. 메모리 (Memory)


### 6. 에이전트 (Agents)



## Reference

- [링크1](https://brunch.co.kr/@ywkim36/147)
- [링크2](https://wikidocs.net/231153)